let videoData=[],currentUrl=window.location.href,hashData=currentUrl.split("#")[1];function isValidBase64(t){try{return btoa(atob(t))===t}catch(e){return!1}}if(hashData){if(isValidBase64(hashData))try{let t=atob(hashData);videoData=JSON.parse(t)}catch(e){console.error("Error decoding or parsing video data:",e)}else console.error("Invalid Base64 string.")}else console.error("No hash data found in the URL.");let skip=videoData&&videoData.skip?videoData.skip:0;import{VidstackPlayer as r,VidstackPlayerLayout as a}from"https://cdn.jsdelivr.net/gh/itspro-dev/project_files@master/player/vidstack.player.js";function resizeIframe(){let t=document.querySelector("media-player");t.style.height=window.innerHeight+"px"}function addSkipButton(t,e,r,a){let i=document.querySelector("media-player"),n=document.createElement("button");n.textContent="Skip Intro",n.classList.add("skip-button","button__outline--white"),n.id="skipButtonIntro",i.appendChild(n);let s=document.createElement("button");s.textContent="Skip Outro",s.classList.add("skip-button","button__outline--white"),n.style.display="none",s.id="skipButtonOutro",i.appendChild(s),r.addEventListener("time-update",()=>{if(null!=t.start&&null!=t.end&&0!=t.start||0!=t.end){if(r.currentTime<t.start||r.currentTime>t.end){let i=document.querySelector(".vds-chapter-title");i&&""===i.textContent&&(i.textContent=a)}if(r.currentTime>=t.start&&r.currentTime<=t.end){if("1"==skip){r.currentTime=Number(t.end)+1;return}n.style.display="block",n.classList.remove("fadeOutRight"),n.classList.add("fadeInRight")}else n.classList.remove("fadeInRight"),n.classList.add("fadeOutRight");n.addEventListener("click",()=>{r.currentTime=Number(t.end)+1})}if(null!=e.start&&null!=e.end&&0!=e.start||0!=e.end){if(r.currentTime<e.start||r.currentTime>e.end){let l=document.querySelector(".vds-chapter-title");l&&""===l.textContent&&(l.textContent=a)}if(r.currentTime>=e.start&&r.currentTime<=e.end){if("1"==skip){r.currentTime=Number(e.end)+1;return}s.style.display="block",s.classList.remove("fadeOutRight"),s.classList.add("fadeInRight")}else s.classList.remove("fadeInRight"),s.classList.add("fadeOutRight");s.addEventListener("click",()=>{r.currentTime=Number(e.end)+1})}})}function generateVTT(t){let e="WEBVTT\n\n";return t.forEach((t,r)=>{e+=r+1+"\n",e+=formatTime(t.start)+" --> "+formatTime(t.end)+"\n",e+=t.title+"\n\n"}),e}function formatTime(t){let e=new Date(0);return e.setSeconds(t),e.toISOString().substr(11,12)}async function initializeVideoPlayer(t){let e=[],i=t.captions.length;t.captions.forEach(t=>{let r=t.label.toLowerCase(),a={kind:"subtitles",src:t.file,label:t.label,default:r.includes("english")||r.startsWith("eng")||1===i};e.push(a)});let n={start:t.intro.start,end:t.intro.end},s={start:t.outro.start,end:t.outro.end};if(t.intro.start||t.outro.start){let l=null,o=[];t.intro.start&&o.push({start:n.start,end:n.end,title:"Intro"}),t.outro.start&&o.push({start:s.start,end:s.end,title:"Outro"}),l={kind:"chapters",src:"data:text/vtt,"+generateVTT(o),default:!0},e.push(l)}let d=await r.create({target:"#player",title:t.title,src:t.hlsUrl,layout:new a({thumbnails:t.thumbnailUrl}),tracks:e});d.playsInline=!0,d.autoplay=!0,(t.intro.start||t.outro.start)&&addSkipButton(n,s,d,t.title),d.addEventListener("canplay",()=>{document.querySelector("body").classList.remove("loading")}),d.addEventListener("error",()=>{alert("An error occurred while loading the video. Please try again later. If the problem persists, contact support.")}),resizeIframe(),window.addEventListener("resize",resizeIframe),d.addEventListener("time-update",()=>{let t=d.currentTime;t>5&&!isNaN(d.duration)&&window.parent.postMessage({type:"watching-log",currentTime:t,duration:d.duration},"*")})}document.addEventListener("DOMContentLoaded",()=>{let t={hlsUrl:videoData.sources,title:"",captions:videoData.tracks,thumbnailUrl:"",intro:videoData.intro,outro:videoData.outro};initializeVideoPlayer(t).then(t=>t)});
