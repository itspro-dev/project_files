let skip=videoData&&videoData.skip?videoData.skip:0;import{VidstackPlayer as t,VidstackPlayerLayout as e}from"https://cdn.jsdelivr.net/gh/itspro-dev/project_files@master/player/vidstack.player.js";function resizeIframe(){let t=document.querySelector("media-player");t.style.height=window.innerHeight+"px"}function addSkipButton(t,e,r,n){let i=document.querySelector("media-player"),a=document.createElement("button");a.textContent="Skip Intro",a.classList.add("skip-button","button__outline--white"),a.id="skipButtonIntro",i.appendChild(a);let s=document.createElement("button");s.textContent="Skip Outro",s.classList.add("skip-button","button__outline--white"),a.style.display="none",s.id="skipButtonOutro",i.appendChild(s),r.addEventListener("time-update",()=>{if(null!=t.start&&null!=t.end&&0!=t.start||0!=t.end){if(r.currentTime<t.start||r.currentTime>t.end){let i=document.querySelector(".vds-chapter-title");i&&""===i.textContent&&(i.textContent=n)}if(r.currentTime>=t.start&&r.currentTime<=t.end){if("1"==skip){r.currentTime=Number(t.end)+1;return}a.style.display="block",a.classList.remove("fadeOutRight"),a.classList.add("fadeInRight")}else a.classList.remove("fadeInRight"),a.classList.add("fadeOutRight");a.addEventListener("click",()=>{r.currentTime=Number(t.end)+1})}if(null!=e.start&&null!=e.end&&0!=e.start||0!=e.end){if(r.currentTime<e.start||r.currentTime>e.end){let l=document.querySelector(".vds-chapter-title");l&&""===l.textContent&&(l.textContent=n)}if(r.currentTime>=e.start&&r.currentTime<=e.end){if("1"==skip){r.currentTime=Number(e.end)+1;return}s.style.display="block",s.classList.remove("fadeOutRight"),s.classList.add("fadeInRight")}else s.classList.remove("fadeInRight"),s.classList.add("fadeOutRight");s.addEventListener("click",()=>{r.currentTime=Number(e.end)+1})}})}function generateVTT(t){let e="WEBVTT\n\n";return t.forEach((t,r)=>{e+=r+1+"\n",e+=formatTime(t.start)+" --> "+formatTime(t.end)+"\n",e+=t.title+"\n\n"}),e}function formatTime(t){let e=new Date(0);return e.setSeconds(t),e.toISOString().substr(11,12)}async function initializeVideoPlayer(r){let n=[],i=r.captions.length;r.captions.forEach(t=>{if("captions"!==t.kind)return;let e=t.label.toLowerCase(),r={kind:"subtitles",src:t.file,label:t.label,default:e.includes("english")||e.startsWith("eng")||1===i};n.push(r)});let a={start:r.intro.start,end:r.intro.end},s={start:r.outro.start,end:r.outro.end};if(r.intro.start||r.outro.start){let l=null,o=[];(r.intro.start||r.intro.end)&&o.push({start:a.start,end:a.end,title:"Intro"}),r.outro.start&&o.push({start:s.start,end:s.end,title:"Outro"}),l={kind:"chapters",src:"data:text/vtt,"+generateVTT(o),default:!0},n.push(l)}let d=await t.create({target:"#player",title:r.title,src:r.hlsUrl,layout:new e({thumbnails:r.thumbnailUrl}),tracks:n});d.playsInline=!0,d.autoplay=!0,(r.intro.start||r.outro.start)&&addSkipButton(a,s,d,r.title),d.addEventListener("canplay",()=>{document.querySelector("body").classList.remove("loading")}),d.addEventListener("error",()=>{alert("An error occurred while loading the video. Please try again later. If the problem persists, contact support.")}),resizeIframe(),window.addEventListener("resize",resizeIframe),d.addEventListener("time-update",()=>{let t=d.currentTime;t>5&&!isNaN(d.duration)&&window.parent.postMessage({type:"watching-log",currentTime:t,duration:d.duration},"*")})}document.addEventListener("DOMContentLoaded",()=>{let t={hlsUrl:videoData.sources,title:"",captions:videoData.tracks,thumbnailUrl:"",intro:videoData.intro,outro:videoData.outro};initializeVideoPlayer(t).then(t=>t)});
